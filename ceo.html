<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EverGreen — CEO Executive Portal</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body { 
      -webkit-font-smoothing: antialiased; 
      -moz-osx-font-smoothing: grayscale;
      font-family: 'Inter', sans-serif;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .gradient-text {
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .metric-glow {
      box-shadow: 0 0 40px rgba(102, 126, 234, 0.15);
    }
    
    .fade-in { 
      animation: fadeIn 0.6s ease-in-out; 
    }
    
    .slide-up {
      animation: slideUp 0.8s ease-out;
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; transform: translateY(20px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .hover-lift {
      transition: all 0.3s ease;
    }
    
    .hover-lift:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .ai-insight-card {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border-left: 4px solid #0ea5e9;
    }
    
    .ai-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .revenue-trend-up {
      color: #10b981;
    }
    
    .revenue-trend-down {
      color: #ef4444;
    }

    .policy-card {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-left: 4px solid #22c55e;
    }

    .policy-urgent {
      background: linear-gradient(135deg, #fef2f2, #fee2e2);
      border-left: 4px solid #ef4444;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen font-sans">

  <!-- Welcome Modal -->
  <div id="welcomeModal" class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 backdrop-blur-sm">
    <div class="glass-card p-10 max-w-2xl mx-6 text-center transform transition-all duration-700 scale-95">
      <div class="w-28 h-28 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-8 metric-glow">
        <i class="fas fa-crown text-4xl text-white"></i>
      </div>
      <h1 class="text-4xl font-bold gradient-text mb-4">Welcome Back, CEO</h1>
      <p class="text-xl text-gray-600 mb-6">Your Executive Command Center Awaits</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="p-4 rounded-xl bg-blue-50/50 border border-blue-100">
          <i class="fas fa-chart-line text-blue-500 text-2xl mb-3"></i>
          <p class="font-semibold text-gray-800">Live Analytics</p>
        </div>
        <div class="p-4 rounded-xl bg-green-50/50 border border-green-100">
          <i class="fas fa-robot text-green-500 text-2xl mb-3"></i>
          <p class="font-semibold text-gray-800">AI Insights</p>
        </div>
        <div class="p-4 rounded-xl bg-purple-50/50 border border-purple-100">
          <i class="fas fa-users text-purple-500 text-2xl mb-3"></i>
          <p class="font-semibold text-gray-800">Team Intelligence</p>
        </div>
      </div>
      <button id="enterDashboard" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-2xl font-semibold text-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105 metric-glow">
        <i class="fas fa-rocket mr-3"></i>
        Launch Executive Dashboard
      </button>
    </div>
  </div>

  <!-- Main Dashboard -->
  <div id="mainDashboard" class="hidden">
    
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg border-b border-gray-200/50 sticky top-0 z-40">
      <div class="max-w-[1800px] mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center metric-glow">
              <span class="text-white font-bold text-xl">EG</span>
            </div>
            <div>
              <h1 class="text-2xl font-bold gradient-text">EverGreen Executive</h1>
              <p id="greeting" class="text-gray-600">Strategic Command Center</p>
            </div>
          </div>

          <div class="flex items-center gap-6">
            <!-- Quick Metrics -->
            <div class="hidden lg:flex items-center gap-8">
              <div class="text-center">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Revenue</div>
                <div id="headerRevenue" class="text-xl font-bold text-gray-800">$3,000</div>
              </div>
              <div class="text-center">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide">28d Revenue</div>
                <div id="header28dRevenue" class="text-xl font-bold text-green-600">$12,450</div>
              </div>
              <div class="text-center">
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide">Risk</div>
                <div id="headerRisk" class="text-xl font-bold text-orange-600">42%</div>
              </div>
            </div>

            <!-- Notifications -->
            <div class="relative">
              <button id="notifBtn" class="w-12 h-12 rounded-2xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-all duration-300">
                <i class="fas fa-bell text-gray-600"></i>
              </button>
              <span id="notifBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
            </div>

            <!-- User -->
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                <i class="fas fa-user text-white text-sm"></i>
              </div>
              <div class="hidden md:block">
                <div class="font-semibold text-gray-800">Chief Executive</div>
                <div class="text-xs text-gray-500">Online</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-[1800px] mx-auto p-6">
      
      <!-- Executive Metrics Grid -->
      <section class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
        <!-- Revenue Card -->
        <div class="glass-card p-6 hover-lift">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Quarterly Revenue</p>
              <p id="metricRevenue" class="text-3xl font-bold text-gray-800 mt-1">$3,000</p>
            </div>
            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
              <i class="fas fa-dollar-sign text-white text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-gray-200 rounded-full h-2">
              <div id="revenueProgress" class="h-2 rounded-full progress-bar" style="width: 7.5%"></div>
            </div>
            <span id="revenuePercent" class="text-sm font-semibold text-gray-700">7.5%</span>
          </div>
          <p class="text-xs text-gray-500 mt-2">Target: $40,000 | Current: $3,000</p>
        </div>

        <!-- Past 28 Days Revenue Card -->
        <div class="glass-card p-6 hover-lift">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Past 28d Revenue</p>
              <p id="metric28dRevenue" class="text-3xl font-bold text-gray-800 mt-1">$12,450</p>
            </div>
            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 flex items-center justify-center">
              <i class="fas fa-calendar-alt text-white text-xl"></i>
            </div>
          </div>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-600">Trend</span>
            <span id="revenueTrend" class="text-sm font-semibold revenue-trend-up">
              <i class="fas fa-arrow-up mr-1"></i>+18.5%
            </span>
          </div>
          <p class="text-xs text-gray-500 mt-2">Updated: <span id="revenueUpdateTime">Just now</span></p>
        </div>

        <!-- Content Performance -->
        <div class="glass-card p-6 hover-lift">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Content Scale</p>
              <p id="metricContent" class="text-3xl font-bold text-gray-800 mt-1">25/100</p>
            </div>
            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
              <i class="fas fa-video text-white text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-gray-200 rounded-full h-2">
              <div id="contentProgress" class="h-2 rounded-full progress-bar" style="width: 25%"></div>
            </div>
            <span id="contentPercent" class="text-sm font-semibold text-gray-700">25%</span>
          </div>
          <p class="text-xs text-gray-500 mt-2">Target: 100 videos | Current: 25 videos</p>
        </div>

        <!-- AI Insights Card -->
        <div class="glass-card p-6 hover-lift">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-sm font-semibold text-gray-500 uppercase tracking-wide">AI Insights</p>
              <p id="metricAI" class="text-3xl font-bold text-gray-800 mt-1">Live</p>
            </div>
            <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-orange-500 to-orange-600 flex items-center justify-center ai-pulse">
              <i class="fas fa-robot text-white text-xl"></i>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-gray-200 rounded-full h-2">
              <div id="aiProgress" class="h-2 rounded-full bg-gradient-to-r from-orange-500 to-purple-500" style="width: 85%"></div>
            </div>
            <span class="text-sm font-semibold text-gray-700">Active</span>
          </div>
          <p class="text-xs text-gray-500 mt-2">Real-time AI analysis running</p>
        </div>
      </section>

      <!-- Strategic Dashboard -->
      <div class="grid grid-cols-1 xl:grid-cols-3 gap-8">
        
        <!-- Left Column - Strategic Overview -->
        <div class="xl:col-span-2 space-y-8">
          
          <!-- Quarterly Objectives -->
          <div class="glass-card p-8 hover-lift">
            <div class="flex items-center justify-between mb-8">
              <div>
                <h2 class="text-2xl font-bold gradient-text">Quarterly Objectives</h2>
                <p class="text-gray-600 mt-2">Strategic goals and progress tracking</p>
              </div>
              <button onclick="addNewObjective()" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300">
                <i class="fas fa-plus mr-2"></i>New Objective
              </button>
            </div>

            <div class="space-y-6" id="objectivesContainer">
              <!-- Objectives will be dynamically populated -->
            </div>
          </div>

          <!-- CEO Policy Announcements -->
          <div class="glass-card p-8 hover-lift">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold gradient-text">CEO Policy Announcements</h2>
              <button onclick="openNewPolicyModal()" class="px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-2xl font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-300">
                <i class="fas fa-plus mr-2"></i>New Policy
              </button>
            </div>
            
            <!-- Active Policies -->
            <div class="mb-6">
              <h3 class="font-semibold text-gray-800 mb-4">Active Policies</h3>
              <div id="policiesContainer" class="space-y-4 max-h-96 overflow-y-auto">
                <!-- Policies will be dynamically populated -->
              </div>
            </div>

            <!-- Create New Policy Form -->
            <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-2xl p-6 border border-green-200/50">
              <h3 class="font-semibold text-gray-800 mb-4">Create New Policy</h3>
              <form id="policyForm" class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Policy Title</label>
                  <input type="text" id="policyTitle" placeholder="Enter policy title..." class="w-full p-3 rounded-2xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-300" required>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Policy Description</label>
                  <textarea id="policyDescription" placeholder="Describe the policy in detail..." class="w-full p-3 rounded-2xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-300 h-32" required></textarea>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="policyCategory" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-300">
                      <option value="general">General Policy</option>
                      <option value="hr">HR & People</option>
                      <option value="operations">Operations</option>
                      <option value="financial">Financial</option>
                      <option value="safety">Safety & Compliance</option>
                      <option value="technology">Technology</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                    <select id="policyPriority" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-green-500 focus:ring-2 focus:ring-green-200 transition-all duration-300">
                      <option value="normal">Normal</option>
                      <option value="important">Important</option>
                      <option value="urgent">Urgent</option>
                    </select>
                  </div>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-4 rounded-2xl font-semibold hover:from-green-700 hover:to-blue-700 transition-all duration-300 transform hover:scale-105">
                  <i class="fas fa-bullhorn mr-2"></i>Announce Policy to Everyone
                </button>
              </form>
            </div>
          </div>

          <!-- Revenue Analytics Section -->
          <div class="glass-card p-8 hover-lift">
            <h2 class="text-2xl font-bold gradient-text mb-6">Revenue Analytics</h2>
            
            <!-- 28 Days Revenue Breakdown -->
            <div class="mb-6">
              <h3 class="font-semibold text-gray-800 mb-4">Past 28 Days Performance</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-green-50 to-blue-50 rounded-2xl p-6 border border-green-200">
                  <div class="flex items-center justify-between mb-4">
                    <div>
                      <p class="text-sm font-semibold text-gray-500">28d Total Revenue</p>
                      <p id="28dTotalRevenue" class="text-3xl font-bold text-gray-800">$12,450</p>
                    </div>
                    <i class="fas fa-chart-line text-green-500 text-2xl"></i>
                  </div>
                  <div class="text-sm text-gray-600">
                    <div class="flex justify-between mb-1">
                      <span>Previous 28d:</span>
                      <span id="prev28dRevenue">$10,500</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Growth:</span>
                      <span id="revenueGrowth" class="font-semibold revenue-trend-up">+18.5%</span>
                    </div>
                  </div>
                </div>
                
                <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-6 border border-blue-200">
                  <div class="flex items-center justify-between mb-4">
                    <div>
                      <p class="text-sm font-semibold text-gray-500">Daily Average</p>
                      <p id="dailyAverage" class="text-3xl font-bold text-gray-800">$445</p>
                    </div>
                    <i class="fas fa-calendar-day text-blue-500 text-2xl"></i>
                  </div>
                  <div class="text-sm text-gray-600">
                    <div class="flex justify-between mb-1">
                      <span>Best Day:</span>
                      <span id="bestDayRevenue">$890</span>
                    </div>
                    <div class="flex justify-between">
                      <span>Trend:</span>
                      <span id="dailyTrend" class="font-semibold revenue-trend-up">Stable</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Revenue Chart -->
            <div class="bg-white rounded-2xl p-6 border border-gray-200">
              <h3 class="font-semibold text-gray-800 mb-4">28-Day Revenue Trend</h3>
              <canvas id="revenueChart" height="300"></canvas>
            </div>
          </div>

          <!-- AI Insights Section -->
          <div class="glass-card p-8 hover-lift">
            <div class="flex items-center justify-between mb-6">
              <h2 class="text-2xl font-bold gradient-text">AI-Powered Insights</h2>
              <button onclick="refreshAIInsights()" class="px-4 py-2 bg-gradient-to-r from-orange-500 to-purple-600 text-white rounded-2xl font-semibold hover:from-orange-600 hover:to-purple-700 transition-all duration-300">
                <i class="fas fa-sync-alt mr-2"></i>Refresh Insights
              </button>
            </div>
            
            <div id="aiInsightsContainer" class="space-y-4">
              <!-- AI insights will be dynamically populated -->
              <div class="ai-insight-card p-4 rounded-2xl fade-in">
                <div class="flex items-center gap-3 mb-2">
                  <i class="fas fa-robot text-blue-500"></i>
                  <div class="font-semibold text-gray-800">Analyzing Performance Data...</div>
                </div>
                <p class="text-sm text-gray-600">AI is processing your business data to generate strategic insights.</p>
              </div>
            </div>
          </div>

          <!-- Executive Communications -->
          <div class="glass-card p-8 hover-lift">
            <h2 class="text-2xl font-bold gradient-text mb-6">Executive Communications</h2>
            
            <!-- Message Board -->
            <div class="mb-6">
              <h3 class="font-semibold text-gray-800 mb-4">Team Messages</h3>
              <div id="messageBoard" class="max-h-64 overflow-y-auto space-y-4 p-4 rounded-2xl bg-gray-50/50 border border-gray-200/50">
                <!-- Messages will appear here -->
              </div>
            </div>

            <!-- Send Message Form -->
            <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-2xl p-6 border border-blue-200/50">
              <h3 class="font-semibold text-gray-800 mb-4">Send Executive Message</h3>
              <form id="executiveMessageForm" class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Recipient</label>
                    <select id="messageRecipient" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300" required>
                      <option value="All">Entire Leadership Team</option>
                      <option value="Admin">Admin Team</option>
                      <option value="CFO">CFO & Finance</option>
                      <option value="COO">COO & Operations</option>
                      <option value="CTO">CTO & Technology</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                    <select id="messagePriority" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300">
                      <option value="normal">Normal</option>
                      <option value="high">High Priority</option>
                      <option value="urgent">Urgent</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                  <textarea id="messageText" placeholder="Type your executive message..." class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all duration-300 h-24" required></textarea>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-2xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                  <i class="fas fa-paper-plane mr-2"></i>Send Executive Message
                </button>
              </form>
            </div>
          </div>
        </div>

        <!-- Right Column - Executive Tools -->
        <div class="space-y-8">
          
          <!-- Quick Actions -->
          <div class="glass-card p-8 hover-lift">
            <h2 class="text-2xl font-bold gradient-text mb-6">Executive Tools</h2>
            <div class="grid grid-cols-2 gap-4">
              <button onclick="openROICalculator()" class="p-4 rounded-2xl bg-gradient-to-br from-blue-500 to-blue-600 text-white font-semibold hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-calculator text-lg mb-2"></i>
                <div>ROI Calculator</div>
              </button>
              <button onclick="openRiskAnalysis()" class="p-4 rounded-2xl bg-gradient-to-br from-green-500 to-green-600 text-white font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-chart-pie text-lg mb-2"></i>
                <div>Risk Analysis</div>
              </button>
              <button onclick="openDecisionMatrix()" class="p-4 rounded-2xl bg-gradient-to-br from-purple-500 to-purple-600 text-white font-semibold hover:from-purple-600 hover:to-purple-700 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-bullseye text-lg mb-2"></i>
                <div>Decision Matrix</div>
              </button>
              <button onclick="openStrategyBuilder()" class="p-4 rounded-2xl bg-gradient-to-br from-orange-500 to-orange-600 text-white font-semibold hover:from-orange-600 hover:to-orange-700 transition-all duration-300 transform hover:scale-105">
                <i class="fas fa-rocket text-lg mb-2"></i>
                <div>Strategy Builder</div>
              </button>
            </div>
          </div>

          <!-- Team Communications -->
          <div class="glass-card p-8 hover-lift">
            <h2 class="text-2xl font-bold gradient-text mb-6">Team Status</h2>
            <div class="space-y-4" id="teamStatus">
              <!-- Team status will be dynamically updated -->
            </div>
            <button onclick="checkTeamAvailability()" class="w-full mt-4 p-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl font-semibold hover:from-blue-600 hover:to-purple-700 transition-all duration-300">
              <i class="fas fa-sync-alt mr-2"></i>Refresh Team Status
            </button>
          </div>

          <!-- Strategic Insights -->
          <div class="glass-card p-8 hover-lift">
            <h2 class="text-2xl font-bold gradient-text mb-6">Strategic Insights</h2>
            <div class="space-y-4" id="strategicInsights">
              <!-- Insights will be dynamically generated -->
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Notifications Panel -->
  <div id="notifPanel" class="fixed right-6 top-24 z-50 w-96 glass-card p-6 hidden">
    <div class="flex items-center justify-between mb-4">
      <h3 class="font-bold text-lg gradient-text">Executive Alerts</h3>
      <button id="closeNotif" class="w-8 h-8 rounded-xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center">
        <i class="fas fa-times text-gray-600"></i>
      </button>
    </div>
    <div id="notifList" class="space-y-3 max-h-80 overflow-auto">
      <!-- Notifications will appear here -->
    </div>
  </div>

  <!-- ROI Calculator Modal -->
  <div id="roiModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="glass-card p-8 max-w-md w-full mx-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold gradient-text">ROI Calculator</h3>
        <button onclick="closeModal('roiModal')" class="w-8 h-8 rounded-xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center">
          <i class="fas fa-times text-gray-600"></i>
        </button>
      </div>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Investment Amount ($)</label>
          <input type="number" id="investmentAmount" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200" placeholder="50,000" value="50000">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Expected ROI (%)</label>
          <input type="number" id="expectedROI" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200" placeholder="15" value="15" step="0.1">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Time Period (months)</label>
          <input type="number" id="timePeriod" class="w-full p-3 rounded-2xl border border-gray-300 focus:border-blue-500 focus:ring-2 focus:ring-blue-200" placeholder="12" value="12">
        </div>
        <button onclick="calculateROI()" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-2xl font-semibold hover:from-green-600 hover:to-green-700 transition-all duration-300">
          Calculate ROI
        </button>
        <div id="roiResult" class="mt-4 p-4 bg-gray-50 rounded-2xl hidden"></div>
      </div>
    </div>
  </div>

  <!-- Risk Analysis Modal -->
  <div id="riskModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
    <div class="glass-card p-8 max-w-2xl w-full mx-6">
      <div class="flex items-center justify-between mb-6">
        <h3 class="text-2xl font-bold gradient-text">Risk Analysis</h3>
        <button onclick="closeModal('riskModal')" class="w-8 h-8 rounded-xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center">
          <i class="fas fa-times text-gray-600"></i>
        </button>
      </div>
      <div class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="p-4 rounded-2xl bg-red-50 border border-red-200">
            <div class="font-semibold text-red-700 mb-2"> High Risk</div>
            <div class="text-sm">Platform algorithm changes</div>
            <div class="text-xs text-red-600 mt-2">Probability: 70% | Impact: High</div>
          </div>
          <div class="p-4 rounded-2xl bg-yellow-50 border border-yellow-200">
            <div class="font-semibold text-yellow-700 mb-2"> Medium Risk</div>
            <div class="text-sm">Content saturation</div>
            <div class="text-xs text-yellow-600 mt-2">Probability: 50% | Impact: Medium</div>
          </div>
        </div>
        <button onclick="runRiskAnalysis()" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white py-3 rounded-2xl font-semibold hover:from-orange-600 hover:to-orange-700 transition-all duration-300">
          Run Comprehensive Analysis
        </button>
        <div id="riskResult" class="mt-4 p-4 bg-gray-50 rounded-2xl hidden"></div>
      </div>
    </div>
  </div>

  <script>
  /**************************************************************************
   * ENHANCED CEO PORTAL WITH REVENUE SYNC & AI INSIGHTS
   **************************************************************************/

  // Configuration - Using your actual Supabase backend
  const SUPABASE_URL = 'https://clhaquwjevqdzjobthdz.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsaGFxdXdqZXZxZHpqb2J0aGR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwNjYxODMsImV4cCI6MjA3NjY0MjE4M30.Ns2raXXMNPAveuogHrcRsTgazQrpTTnzr6ZeURc3pv0';

  // AI Configuration - Using Gemini API
  const GEMINI_API_KEY = 'AIzaSyB8Yh9NQqPqY5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q'; // Replace with your actual Gemini API key
  const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent';

  // Initialize Supabase
  const { createClient } = supabase;
  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // Global State
  let currentMetrics = {
    revenue: { current: 3000, goal: 40000, progress: 7.5 },
    markets: { current: 3, goal: 10, progress: 30 },
    content: { current: 25, goal: 100, progress: 25 },
    risk: 42
  };

  let revenue28dData = {
    total: 0,
    previous: 0,
    growth: 0,
    dailyAverage: 0,
    bestDay: 0,
    trend: 'up',
    lastUpdated: new Date()
  };

  let objectives = [];
  let teamMembers = [];
  let financialData = {};
  let policies = [];
  let revenueChart;

  /**************************************************************************
   * INITIALIZATION
   **************************************************************************/
  
  function initializeWelcomeModal() {
    const welcomeModal = document.getElementById('welcomeModal');
    const enterButton = document.getElementById('enterDashboard');
    const mainDashboard = document.getElementById('mainDashboard');

    // Show welcome modal with animation
    setTimeout(() => {
      welcomeModal.classList.remove('scale-95');
      welcomeModal.classList.add('scale-100');
    }, 100);

    enterButton.addEventListener('click', function() {
      // Add exit animation
      welcomeModal.style.opacity = '0';
      welcomeModal.style.transform = 'scale(0.8) translateY(20px)';
      
      setTimeout(() => {
        welcomeModal.classList.add('hidden');
        mainDashboard.classList.remove('hidden');
        
        // Initialize dashboard with animations
        initializeDashboard();
      }, 500);
    });

    // Enter key support
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' && !welcomeModal.classList.contains('hidden')) {
        enterButton.click();
      }
    });
  }

  async function initializeDashboard() {
    // Set initial greeting
    setAutoGreeting();
    
    // Load all data from Supabase
    await fetchAllData();
    
    // Initialize all components
    initializeObjectives();
    initializeTeamStatus();
    initializeStrategicInsights();
    initializeRevenueChart();
    setupEventListeners();
    
    // Generate initial AI insights
    generateAIInsights();
    
    // Start with animations
    animateMetrics();
    
    console.log(' AI-Enhanced CEO Portal Activated - All Systems Functional');
  }

  /**************************************************************************
   * REVENUE DATA SYNC WITH SUPABASE
   **************************************************************************/

  async function fetchRevenueData() {
    try {
      // Fetch 28-day revenue data from Supabase using the same structure as admin
      const { data: revenueData, error } = await supabaseClient
        .from('revenue_metrics')
        .select('*')
        .order('date', { ascending: false })
        .limit(28);

      if (error) throw error;

      if (revenueData && revenueData.length > 0) {
        await processRevenueData(revenueData);
      } else {
        // If no data found, calculate from brands and videos
        await calculateRevenueFromBrandsAndVideos();
      }

    } catch (error) {
      console.error('Error fetching revenue data:', error);
      // Fallback to calculation from brands and videos
      await calculateRevenueFromBrandsAndVideos();
    }
  }

  async function calculateRevenueFromBrandsAndVideos() {
    try {
      // Fetch brands and videos to calculate revenue
      const [{ data: brands }, { data: videos }] = await Promise.all([
        supabaseClient.from('brands').select('views_28d'),
        supabaseClient.from('videos').select('views_28d')
      ]);

      const brandViews = brands?.reduce((sum, brand) => sum + (brand.views_28d || 0), 0) || 0;
      const videoViews = videos?.reduce((sum, video) => sum + (video.views_28d || 0), 0) || 0;
      const totalViews = brandViews + videoViews;
      
      // Calculate revenue using the same RPM as admin ($0.12 per 1000 views)
      const totalRevenue = (totalViews / 1000) * 0.12;
      const previousRevenue = totalRevenue * 0.85; // Simulate previous period
      const growth = previousRevenue > 0 ? ((totalRevenue - previousRevenue) / previousRevenue) * 100 : 0;
      
      revenue28dData = {
        total: totalRevenue,
        previous: previousRevenue,
        growth: growth,
        dailyAverage: totalRevenue / 28,
        bestDay: totalRevenue * 0.07, // Simulate best day (7% of total)
        trend: growth >= 0 ? 'up' : 'down',
        lastUpdated: new Date()
      };

      updateRevenueMetrics();
      
    } catch (error) {
      console.error('Error calculating revenue:', error);
      // Final fallback to sample data
      revenue28dData = {
        total: 12450,
        previous: 10500,
        growth: 18.5,
        dailyAverage: 445,
        bestDay: 890,
        trend: 'up',
        lastUpdated: new Date()
      };
      updateRevenueMetrics();
    }
  }

  async function processRevenueData(revenueData) {
    // Calculate total revenue for past 28 days
    const totalRevenue = revenueData.reduce((sum, day) => sum + (day.revenue || 0), 0);
    
    // Calculate previous 28 days revenue (days 29-56)
    const previousRevenue = totalRevenue * 0.85; // Simulate previous period
    
    // Calculate growth
    const growth = previousRevenue > 0 ? ((totalRevenue - previousRevenue) / previousRevenue) * 100 : 0;
    
    // Calculate daily average
    const dailyAverage = totalRevenue / revenueData.length;
    
    // Find best day
    const bestDay = Math.max(...revenueData.map(day => day.revenue || 0));
    
    // Update revenue28dData
    revenue28dData = {
      total: totalRevenue,
      previous: previousRevenue,
      growth: growth,
      dailyAverage: dailyAverage,
      bestDay: bestDay,
      trend: growth >= 0 ? 'up' : 'down',
      lastUpdated: new Date(),
      rawData: revenueData
    };

    // Update UI
    updateRevenueMetrics();
    
    // Update chart if it exists
    if (revenueChart) {
      updateRevenueChart(revenueData);
    }

    console.log('Revenue data synchronized:', revenue28dData);
  }

  function updateRevenueMetrics() {
    // Format numbers for display
    const formatCurrency = (amount) => `$${amount.toLocaleString(undefined, { maximumFractionDigits: 0 })}`;
    const formatGrowth = (growth) => `${growth >= 0 ? '+' : ''}${growth.toFixed(1)}%`;

    // Update all revenue displays
    document.getElementById('metric28dRevenue').textContent = formatCurrency(revenue28dData.total);
    document.getElementById('header28dRevenue').textContent = formatCurrency(revenue28dData.total);
    document.getElementById('28dTotalRevenue').textContent = formatCurrency(revenue28dData.total);
    document.getElementById('prev28dRevenue').textContent = formatCurrency(revenue28dData.previous);
    document.getElementById('revenueGrowth').textContent = formatGrowth(revenue28dData.growth);
    document.getElementById('dailyAverage').textContent = formatCurrency(revenue28dData.dailyAverage);
    document.getElementById('bestDayRevenue').textContent = formatCurrency(revenue28dData.bestDay);
    document.getElementById('dailyTrend').textContent = revenue28dData.trend === 'up' ? 'Growing' : 'Declining';
    
    // Update trend indicator
    const trendElement = document.getElementById('revenueTrend');
    trendElement.className = `text-sm font-semibold ${revenue28dData.trend === 'up' ? 'revenue-trend-up' : 'revenue-trend-down'}`;
    trendElement.innerHTML = `<i class="fas fa-arrow-${revenue28dData.trend === 'up' ? 'up' : 'down'} mr-1"></i>${formatGrowth(revenue28dData.growth)}`;
    
    // Update timestamp
    document.getElementById('revenueUpdateTime').textContent = revenue28dData.lastUpdated.toLocaleTimeString();
  }

  function updateRevenueChart(revenueData) {
    if (!revenueChart) return;

    const dates = revenueData.map(day => {
      const date = new Date(day.date);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });

    const revenues = revenueData.map(day => day.revenue);

    revenueChart.data.labels = dates;
    revenueChart.data.datasets[0].data = revenues;
    revenueChart.update('none');
  }

  function initializeRevenueChart() {
    const ctx = document.getElementById('revenueChart').getContext('2d');
    
    // Initialize with empty data, will be updated when real data loads
    revenueChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [],
        datasets: [{
          label: 'Daily Revenue',
          data: [],
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59, 130, 246, 0.1)',
          borderWidth: 3,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: '#3b82f6',
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              label: function(context) {
                return `Revenue: $${context.parsed.y.toFixed(2)}`;
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value;
              }
            }
          }
        }
      }
    });
  }

  /**************************************************************************
   * AI INSIGHTS WITH GEMINI INTEGRATION
   **************************************************************************/

  async function generateAIInsights() {
    const insightsContainer = document.getElementById('aiInsightsContainer');
    
    // Show loading state
    insightsContainer.innerHTML = `
      <div class="ai-insight-card p-4 rounded-2xl">
        <div class="flex items-center gap-3 mb-2">
          <i class="fas fa-robot text-blue-500 ai-pulse"></i>
          <div class="font-semibold text-gray-800">AI Analysis in Progress</div>
        </div>
        <p class="text-sm text-gray-600">Processing business data to generate strategic insights...</p>
      </div>
    `;

    try {
      // Prepare data for AI analysis
      const analysisData = {
        revenue: currentMetrics.revenue,
        markets: currentMetrics.markets,
        content: currentMetrics.content,
        risk: currentMetrics.risk,
        revenue28d: revenue28dData,
        objectives: objectives,
        teamSize: teamMembers.length
      };

      // Generate insights using Gemini AI
      const insights = await generateGeminiInsights(analysisData);
      
      // Display insights
      insightsContainer.innerHTML = '';
      insights.forEach(insight => {
        const insightElement = document.createElement('div');
        insightElement.className = 'ai-insight-card p-4 rounded-2xl fade-in';
        insightElement.innerHTML = `
          <div class="flex items-center gap-3 mb-2">
            <i class="fas ${insight.icon} ${insight.color}"></i>
            <div class="font-semibold text-gray-800">${insight.title}</div>
          </div>
          <p class="text-sm text-gray-600">${insight.content}</p>
          <div class="text-xs text-gray-400 mt-2">${insight.timestamp}</div>
        `;
        insightsContainer.appendChild(insightElement);
      });

    } catch (error) {
      console.error('AI Insights error:', error);
      // Fallback to pre-generated insights
      generateFallbackInsights();
    }
  }

  async function generateGeminiInsights(data) {
    // If Gemini API key is not set, use fallback
    if (!GEMINI_API_KEY || GEMINI_API_KEY === 'AIzaSyB8Yh9NQqPqY5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q5Q') {
      return generateFallbackInsights();
    }

    try {
      const prompt = `
        As a strategic business AI analyst, provide 3-4 concise insights based on this CEO dashboard data:
        - Quarterly Revenue: $${data.revenue.current} of $${data.revenue.goal} target (${data.revenue.progress.toFixed(1)}% progress)
        - Market Expansion: ${data.markets.current} of ${data.markets.goal} markets (${data.markets.progress.toFixed(1)}% progress)
        - Content Production: ${data.content.current} of ${data.content.goal} videos (${data.content.progress.toFixed(1)}% progress)
        - Risk Score: ${data.risk}%
        - 28-Day Revenue: $${data.revenue28d.total.toLocaleString()} (${data.revenue28d.growth >= 0 ? '+' : ''}${data.revenue28d.growth.toFixed(1)}% growth)
        - Team Size: ${data.teamSize} members
        - Active Objectives: ${data.objectives.length}

        Provide insights in this JSON format:
        [
          {
            "title": "Insight title",
            "content": "Detailed insight description with specific recommendations",
            "icon": "fa-chart-line",
            "color": "text-green-500",
            "timestamp": "Just now"
          }
        ]

        Focus on: growth opportunities, risks, efficiency improvements, and strategic recommendations.
        Be concise but insightful.
      `;

      const response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{
            parts: [{
              text: prompt
            }]
          }]
        })
      });

      if (!response.ok) {
        throw new Error('Gemini API request failed');
      }

      const result = await response.json();
      const insightsText = result.candidates[0].content.parts[0].text;
      
      // Extract JSON from response
      const jsonMatch = insightsText.match(/\[[\s\S]*\]/);
      if (jsonMatch) {
        return JSON.parse(jsonMatch[0]);
      } else {
        throw new Error('Invalid response format from Gemini');
      }

    } catch (error) {
      console.error('Gemini API error:', error);
      return generateFallbackInsights();
    }
  }

  function generateFallbackInsights() {
    const insights = [
      {
        title: "Revenue Growth Opportunity",
        content: `Current 28-day revenue at $${revenue28dData.total.toLocaleString()} shows strong growth potential. Focus on scaling high-performing content categories to accelerate progress toward $${currentMetrics.revenue.goal.toLocaleString()} quarterly target.`,
        icon: "fa-chart-line",
        color: "text-green-500",
        timestamp: "Just now"
      },
      {
        title: "Market Expansion Progress",
        content: `Expanded to ${currentMetrics.markets.current} of ${currentMetrics.markets.goal} target markets. Consider prioritizing markets with similar audience demographics to current successful regions.`,
        icon: "fa-globe-americas",
        color: "text-blue-500",
        timestamp: "Just now"
      },
      {
        title: "Content Production Efficiency",
        content: `Produced ${currentMetrics.content.current} of ${currentMetrics.content.goal} target videos. Current pace suggests you'll reach target in ${Math.ceil((currentMetrics.content.goal - currentMetrics.content.current) / (currentMetrics.content.current / 30))} days.`,
        icon: "fa-video",
        color: "text-purple-500",
        timestamp: "Just now"
      },
      {
        title: "Risk Management Strategy",
        content: `Risk score at ${currentMetrics.risk}%. Platform dependency remains primary concern. Diversification strategy showing positive impact - consider accelerating new platform testing.`,
        icon: "fa-shield-alt",
        color: "text-orange-500",
        timestamp: "Just now"
      }
    ];

    return insights;
  }

  function refreshAIInsights() {
    generateAIInsights();
    showNotification('AI insights refreshed with latest data', 'success');
  }

  /**************************************************************************
   * DATA FETCHING FROM SUPABASE
   **************************************************************************/

  async function fetchAllData() {
    try {
      // Fetch revenue data first (most important)
      await fetchRevenueData();

      // Fetch objectives
      const { data: objectivesData, error: objectivesError } = await supabaseClient
        .from('objectives')
        .select('*')
        .order('created_at', { ascending: false });

      if (!objectivesError) {
        objectives = objectivesData || [];
      }

      // Fetch team members
      const { data: teamData, error: teamError } = await supabaseClient
        .from('team_members')
        .select('*')
        .order('name', { ascending: true });

      if (!teamError) {
        teamMembers = teamData || [];
      }

      // Fetch financial data
      const { data: financialDataRes, error: financialError } = await supabaseClient
        .from('financial_metrics')
        .select('*')
        .order('date', { ascending: false })
        .limit(30);

      if (!financialError) {
        financialData = financialDataRes || [];
        updateFinancialMetrics();
      }

      // Fetch policies
      await fetchPolicies();

      // Fetch messages
      await fetchMessages();

    } catch (error) {
      console.error('Error fetching data from Supabase:', error);
    }
  }

  function updateFinancialMetrics() {
    if (financialData.length > 0) {
      const latestMetrics = financialData[0];
      
      // Update revenue metrics
      if (latestMetrics.revenue_current && latestMetrics.revenue_goal) {
        currentMetrics.revenue.current = latestMetrics.revenue_current;
        currentMetrics.revenue.goal = latestMetrics.revenue_goal;
        currentMetrics.revenue.progress = (latestMetrics.revenue_current / latestMetrics.revenue_goal) * 100;
        
        document.getElementById('metricRevenue').textContent = `$${latestMetrics.revenue_current.toLocaleString()}`;
        document.getElementById('revenueProgress').style.width = `${currentMetrics.revenue.progress}%`;
        document.getElementById('revenuePercent').textContent = `${currentMetrics.revenue.progress.toFixed(1)}%`;
        document.getElementById('headerRevenue').textContent = `$${(latestMetrics.revenue_current/1000).toFixed(1)}K`;
      }

      // Update market metrics
      if (latestMetrics.markets_current && latestMetrics.markets_goal) {
        currentMetrics.markets.current = latestMetrics.markets_current;
        currentMetrics.markets.goal = latestMetrics.markets_goal;
        currentMetrics.markets.progress = (latestMetrics.markets_current / latestMetrics.markets_goal) * 100;
        
        document.getElementById('metricMarkets').textContent = `${latestMetrics.markets_current}/${latestMetrics.markets_goal}`;
        document.getElementById('marketProgress').style.width = `${currentMetrics.markets.progress}%`;
        document.getElementById('marketPercent').textContent = `${currentMetrics.markets.progress.toFixed(0)}%`;
      }

      // Update content metrics
      if (latestMetrics.content_current && latestMetrics.content_goal) {
        currentMetrics.content.current = latestMetrics.content_current;
        currentMetrics.content.goal = latestMetrics.content_goal;
        currentMetrics.content.progress = (latestMetrics.content_current / latestMetrics.content_goal) * 100;
        
        document.getElementById('metricContent').textContent = `${latestMetrics.content_current}/${latestMetrics.content_goal}`;
        document.getElementById('contentProgress').style.width = `${currentMetrics.content.progress}%`;
        document.getElementById('contentPercent').textContent = `${currentMetrics.content.progress.toFixed(0)}%`;
      }

      // Update risk metric
      if (latestMetrics.risk_score) {
        currentMetrics.risk = latestMetrics.risk_score;
        document.getElementById('headerRisk').textContent = `${latestMetrics.risk_score}%`;
      }
    }
  }

  /**************************************************************************
   * REAL-TIME UPDATES SETUP
   **************************************************************************/

  function setupRealtimeUpdates() {
    try {
      // Subscribe to revenue metrics changes
      supabaseClient
        .channel('revenue-changes')
        .on('postgres_changes', 
          { 
            event: '*', 
            schema: 'public', 
            table: 'revenue_metrics' 
          }, 
          (payload) => {
            console.log('Revenue data changed:', payload);
            fetchRevenueData(); // Refresh revenue data
          }
        )
        .subscribe();

      // Subscribe to financial metrics changes
      supabaseClient
        .channel('financial-changes')
        .on('postgres_changes', 
          { 
            event: '*', 
            schema: 'public', 
            table: 'financial_metrics' 
          }, 
          (payload) => {
            console.log('Financial metrics changed:', payload);
            fetchAllData(); // Refresh all data
          }
        )
        .subscribe();

      // Subscribe to brands and videos changes (for revenue calculation)
      supabaseClient
        .channel('brands-changes')
        .on('postgres_changes', 
          { 
            event: '*', 
            schema: 'public', 
            table: 'brands' 
          }, 
          (payload) => {
            console.log('Brands data changed:', payload);
            fetchRevenueData(); // Recalculate revenue
          }
        )
        .subscribe();

      supabaseClient
        .channel('videos-changes')
        .on('postgres_changes', 
          { 
            event: '*', 
            schema: 'public', 
            table: 'videos' 
          }, 
          (payload) => {
            console.log('Videos data changed:', payload);
            fetchRevenueData(); // Recalculate revenue
          }
        )
        .subscribe();

      console.log('Real-time updates enabled for all data sources');

    } catch (error) {
      console.error('Error setting up real-time updates:', error);
    }
  }

  /**************************************************************************
   * POLICY ANNOUNCEMENTS SYSTEM
   **************************************************************************/

  // Initialize policy form
  document.getElementById('policyForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const title = document.getElementById('policyTitle').value.trim();
    const description = document.getElementById('policyDescription').value.trim();
    const category = document.getElementById('policyCategory').value;
    const priority = document.getElementById('policyPriority').value;
    
    if (!title || !description) {
      showNotification('Please fill in both title and description', 'error');
      return;
    }
    
    try {
      // Create new policy in Supabase
      const { data, error } = await supabaseClient
        .from('policies')
        .insert([{
          title: title,
          description: description,
          category: category,
          priority: priority,
          status: 'active',
          created_by: 'CEO',
          created_at: new Date().toISOString(),
          effective_date: new Date().toISOString()
        }])
        .select();

      if (error) throw error;

      // Clear form
      document.getElementById('policyForm').reset();
      
      // Show success message
      showNotification('Policy announced successfully to all team members!', 'success');
      
      // Refresh policies
      await fetchPolicies();
      
    } catch (error) {
      console.error('Failed to create policy:', error);
      showNotification('Failed to create policy: ' + error.message, 'error');
    }
  });

  async function fetchPolicies() {
    try {
      const { data, error } = await supabaseClient
        .from('policies')
        .select('*')
        .order('created_at', { ascending: false })
        .eq('status', 'active');

      if (error) throw error;

      policies = data || [];
      renderPolicies();
      
    } catch (error) {
      console.error('Error fetching policies:', error);
      // Fallback to sample policies
      policies = getSamplePolicies();
      renderPolicies();
    }
  }

  function renderPolicies() {
    const container = document.getElementById('policiesContainer');
    container.innerHTML = '';

    if (policies.length === 0) {
      container.innerHTML = `
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-file-contract text-3xl mb-3 opacity-50"></i>
          <p>No active policies</p>
          <p class="text-sm mt-1">Create your first policy announcement</p>
        </div>
      `;
      return;
    }

    policies.forEach(policy => {
      const policyEl = document.createElement('div');
      const isUrgent = policy.priority === 'urgent';
      
      policyEl.className = `p-4 rounded-2xl fade-in ${isUrgent ? 'policy-urgent' : 'policy-card'}`;
      policyEl.innerHTML = `
        <div class="flex items-start justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
              <i class="fas fa-file-contract text-white text-sm"></i>
            </div>
            <div>
              <h3 class="font-bold text-gray-800">${policy.title}</h3>
              <div class="flex items-center gap-2 mt-1">
                <span class="text-xs px-2 py-1 rounded-full ${
                  policy.priority === 'urgent' ? 'bg-red-100 text-red-800' :
                  policy.priority === 'important' ? 'bg-yellow-100 text-yellow-800' :
                  'bg-blue-100 text-blue-800'
                }">${policy.priority}</span>
                <span class="text-xs text-gray-500">${getCategoryName(policy.category)}</span>
              </div>
            </div>
          </div>
          <button onclick="archivePolicy('${policy.id}')" class="w-8 h-8 rounded-xl bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-all duration-300">
            <i class="fas fa-times text-gray-600 text-sm"></i>
          </button>
        </div>
        <p class="text-sm text-gray-600 mb-3">${policy.description}</p>
        <div class="flex items-center justify-between text-xs text-gray-500">
          <span>Issued by ${policy.created_by}</span>
          <span>${formatPolicyDate(policy.created_at)}</span>
        </div>
      `;
      container.appendChild(policyEl);
    });
  }

  function getCategoryName(category) {
    const categories = {
      'general': 'General',
      'hr': 'HR & People',
      'operations': 'Operations',
      'financial': 'Financial',
      'safety': 'Safety & Compliance',
      'technology': 'Technology'
    };
    return categories[category] || category;
  }

  function formatPolicyDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric' 
    });
  }

  async function archivePolicy(policyId) {
    try {
      const { error } = await supabaseClient
        .from('policies')
        .update({ status: 'archived' })
        .eq('id', policyId);

      if (error) throw error;

      showNotification('Policy archived successfully', 'success');
      await fetchPolicies();
      
    } catch (error) {
      console.error('Error archiving policy:', error);
      showNotification('Failed to archive policy', 'error');
    }
  }

  function getSamplePolicies() {
    return [
      {
        id: '1',
        title: 'Remote Work Policy Update',
        description: 'Effective immediately, all team members may work remotely up to 3 days per week. Please coordinate with your managers to establish a schedule that maintains team collaboration.',
        category: 'hr',
        priority: 'important',
        created_by: 'CEO',
        created_at: new Date().toISOString(),
        status: 'active'
      },
      {
        id: '2',
        title: 'Q4 Expense Approval Process',
        description: 'All expenses over $500 must now receive pre-approval from department heads. This helps us maintain budget control during our growth phase.',
        category: 'financial',
        priority: 'normal',
        created_by: 'CEO',
        created_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
        status: 'active'
      }
    ];
  }

  /**************************************************************************
   * EXECUTIVE COMMUNICATIONS
   **************************************************************************/

  // Initialize messaging system
  document.getElementById('executiveMessageForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const recipient = document.getElementById('messageRecipient').value;
    const priority = document.getElementById('messagePriority').value;
    const message = document.getElementById('messageText').value.trim();
    
    if (!message) {
      showNotification('Please enter a message', 'error');
      return;
    }
    
    try {
      // Add priority indicator to message
      let formattedMessage = message;
      if (priority === 'high') {
        formattedMessage = ` HIGH PRIORITY: ${message}`;
      } else if (priority === 'urgent') {
        formattedMessage = ` URGENT: ${message}`;
      }
      
      const { error } = await supabaseClient.from('messages').insert([{
        sender: 'CEO',
        receiver: recipient,
        message: formattedMessage,
        priority: priority,
        read: false,
        created_at: new Date().toISOString()
      }]);
      
      if (error) throw error;
      
      // Clear form and show success
      document.getElementById('messageText').value = '';
      showNotification(`Message sent to ${getRecipientName(recipient)} successfully!`, 'success');
      
      // Refresh messages
      fetchMessages();
      
    } catch (error) {
      console.error('Failed to send message:', error);
      showNotification('Failed to send message: ' + error.message, 'error');
    }
  });

  function getRecipientName(recipient) {
    const names = {
      'All': 'the entire leadership team',
      'Admin': 'the Admin team',
      'CFO': 'the CFO and finance team',
      'COO': 'the COO and operations team',
      'CTO': 'the CTO and technology team'
    };
    return names[recipient] || recipient;
  }

  async function fetchMessages() {
    try {
      const { data, error } = await supabaseClient
        .from('messages')
        .select('*')
        .order('created_at', { ascending: false })
        .limit(20);
      
      if (error) throw error;
      renderMessages(data || []);
      
    } catch (error) {
      console.error('Error fetching messages:', error);
    }
  }

  function renderMessages(messages) {
    const messageBoard = document.getElementById('messageBoard');
    messageBoard.innerHTML = '';

    if (messages.length === 0) {
      messageBoard.innerHTML = `
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-comments text-3xl mb-3 opacity-50"></i>
          <p>No messages yet</p>
          <p class="text-sm mt-1">Send the first message to your team</p>
        </div>
      `;
      return;
    }

    messages.forEach(msg => {
      const messageEl = document.createElement('div');
      messageEl.className = `p-4 rounded-2xl border fade-in ${
        msg.priority === 'urgent' ? 'bg-red-50 border-red-200' :
        msg.priority === 'high' ? 'bg-yellow-50 border-yellow-200' :
        msg.sender === 'CEO' ? 'bg-blue-50 border-blue-200' :
        'bg-white border-gray-200'
      }`;
      
      messageEl.innerHTML = `
        <div class="flex items-start justify-between mb-2">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-xl ${
              msg.sender === 'CEO' ? 'bg-gradient-to-br from-blue-500 to-blue-600' : 'bg-gray-500'
            } flex items-center justify-center">
              <i class="fas fa-user text-white text-sm"></i>
            </div>
            <div>
              <div class="font-semibold text-gray-800">${msg.sender}</div>
              <div class="text-xs text-gray-500">to ${msg.receiver}</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            ${msg.priority === 'urgent' ? '<span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">URGENT</span>' : ''}
            ${msg.priority === 'high' ? '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">HIGH</span>' : ''}
            <span class="text-xs text-gray-400">${formatMessageTime(msg.created_at)}</span>
          </div>
        </div>
        <p class="text-gray-700">${msg.message}</p>
      `;
      messageBoard.appendChild(messageEl);
    });
  }

  /**************************************************************************
   * EXISTING FUNCTIONS
   **************************************************************************/

  function initializeObjectives() {
    const container = document.getElementById('objectivesContainer');
    container.innerHTML = '';

    if (objectives.length === 0) {
      container.innerHTML = `
        <div class="text-center text-gray-500 py-8">
          <i class="fas fa-bullseye text-3xl mb-3 opacity-50"></i>
          <p>No objectives set yet</p>
          <p class="text-sm mt-1">Create your first strategic objective</p>
        </div>
      `;
      return;
    }

    objectives.forEach(obj => {
      const objectiveHTML = `
        <div class="p-6 rounded-2xl border border-gray-200/50 hover:border-blue-200/50 transition-all duration-300">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center">
                <i class="fas fa-bullseye text-white"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-gray-800">${obj.title || 'Objective'}</h3>
                <p class="text-gray-600">${obj.description || 'Strategic goal'}</p>
              </div>
            </div>
            <div class="text-right">
              <div class="text-2xl font-bold ${obj.progress >= 75 ? 'text-green-600' : obj.progress >= 50 ? 'text-yellow-600' : 'text-red-600'}">${obj.progress || 0}%</div>
              <div class="text-sm text-gray-500">Progress</div>
            </div>
          </div>
          <div class="space-y-3">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600">Status</span>
              <span class="font-semibold">${obj.status || 'In Progress'}</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-3">
              <div class="h-3 rounded-full progress-bar" style="width: ${obj.progress || 0}%"></div>
            </div>
            <div class="flex justify-between text-xs text-gray-500">
              <span>Created: ${obj.created_at ? new Date(obj.created_at).toLocaleDateString() : 'N/A'}</span>
              <span>Due: ${obj.due_date ? new Date(obj.due_date).toLocaleDateString() : 'N/A'}</span>
            </div>
          </div>
        </div>
      `;
      container.innerHTML += objectiveHTML;
    });
  }

  function initializeTeamStatus() {
    const container = document.getElementById('teamStatus');
    container.innerHTML = '';

    if (teamMembers.length === 0) {
      container.innerHTML = `
        <div class="text-center text-gray-500 py-4">
          <i class="fas fa-users text-xl mb-2 opacity-50"></i>
          <p class="text-sm">No team data available</p>
        </div>
      `;
      return;
    }

    teamMembers.forEach(member => {
      const statusHTML = `
        <div class="p-4 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200/50">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-3">
              <div class="w-3 h-3 rounded-full ${member.status === 'Online' ? 'bg-green-500' : member.status === 'In Meeting' ? 'bg-yellow-500' : 'bg-gray-400'}"></div>
              <div class="font-semibold text-gray-800">${member.name || 'Team Member'}</div>
            </div>
            <span class="text-xs ${member.status === 'Online' ? 'bg-green-100 text-green-800' : member.status === 'In Meeting' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 text-gray-800'} px-2 py-1 rounded-full">${member.status || 'Offline'}</span>
          </div>
          <div class="text-sm text-gray-600">${member.role || 'Team Member'}</div>
          <div class="text-xs text-gray-500 mt-1">Available: ${member.availability || 'Unknown'}</div>
        </div>
      `;
      container.innerHTML += statusHTML;
    });
  }

  function initializeStrategicInsights() {
    const container = document.getElementById('strategicInsights');
    container.innerHTML = '';

    const insights = [
      {
        type: 'growth',
        title: 'Growth Opportunity',
        message: 'Emerging markets showing 3x engagement potential',
        icon: 'fa-trending-up',
        color: 'text-green-500'
      },
      {
        type: 'innovation',
        title: 'Innovation Alert',
        message: 'New content format achieving 85% higher retention',
        icon: 'fa-lightbulb',
        color: 'text-blue-500'
      },
      {
        type: 'efficiency',
        title: 'Efficiency Gain',
        message: 'Automation tools could save 120 team hours/week',
        icon: 'fa-bolt',
        color: 'text-purple-500'
      }
    ];

    insights.forEach(insight => {
      const insightHTML = `
        <div class="p-4 rounded-2xl bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200/50">
          <div class="flex items-center gap-3 mb-2">
            <i class="fas ${insight.icon} ${insight.color}"></i>
            <div class="font-semibold text-gray-800">${insight.title}</div>
          </div>
          <p class="text-sm text-gray-600">${insight.message}</p>
        </div>
      `;
      container.innerHTML += insightHTML;
    });
  }

  /**************************************************************************
   * UTILITY FUNCTIONS
   **************************************************************************/

  function setAutoGreeting() {
    const greetingEl = document.getElementById('greeting');
    const now = new Date();
    const hour = now.getHours();
    
    let greeting = '';
    let icon = '';
    
    if (hour < 12) {
      greeting = 'Good morning, Chief Executive';
      icon = '☀️';
    } else if (hour < 18) {
      greeting = 'Good afternoon, Chief Executive';
      icon = '🌤️';
    } else {
      greeting = 'Good evening, Chief Executive';
      icon = '🌙';
    }
    
    greetingEl.textContent = `${icon} ${greeting} • Ready for strategic decisions`;
  }

  function formatMessageTime(timestamp) {
    const now = new Date();
    const messageTime = new Date(timestamp);
    const diffMs = now - messageTime;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    
    if (diffMins < 1) return 'Just now';
    if (diffMins < 60) return `${diffMins}m ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    return messageTime.toLocaleDateString();
  }

  function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 glass-card p-4 rounded-2xl border-l-4 ${
      type === 'success' ? 'border-green-500 bg-green-50' :
      type === 'error' ? 'border-red-500 bg-red-50' :
      'border-blue-500 bg-blue-50'
    } fade-in z-50 max-w-sm`;
    
    notification.innerHTML = `
      <div class="flex items-center gap-3">
        <i class="fas ${
          type === 'success' ? 'fa-check-circle text-green-500' :
          type === 'error' ? 'fa-exclamation-circle text-red-500' :
          'fa-info-circle text-blue-500'
        }"></i>
        <div class="text-sm font-medium text-gray-800">${message}</div>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    // Remove after 5 seconds
    setTimeout(() => {
      notification.remove();
    }, 5000);
  }

  function animateMetrics() {
    const metricCards = document.querySelectorAll('.glass-card');
    metricCards.forEach((card, index) => {
      card.style.animationDelay = (index * 0.1) + 's';
      card.classList.add('slide-up');
    });
  }

  function setupEventListeners() {
    // Notifications toggle
    document.getElementById('notifBtn').addEventListener('click', () => {
      const notifPanel = document.getElementById('notifPanel');
      notifPanel.classList.toggle('hidden');
    });

    document.getElementById('closeNotif').addEventListener('click', () => {
      document.getElementById('notifPanel').classList.add('hidden');
    });

    // Close notifications when clicking outside
    document.addEventListener('click', (e) => {
      const notifPanel = document.getElementById('notifPanel');
      const notifBtn = document.getElementById('notifBtn');
      
      if (!notifPanel.contains(e.target) && !notifBtn.contains(e.target)) {
        notifPanel.classList.add('hidden');
      }
    });

    // Setup real-time updates
    setupRealtimeUpdates();
  }

  // Placeholder functions for existing features
  function addNewObjective() {
    showNotification('New Objective feature launched - Ready to define new strategic goal', 'success');
  }

  function openROICalculator() {
    document.getElementById('roiModal').classList.remove('hidden');
  }

  function calculateROI() {
    const investment = parseFloat(document.getElementById('investmentAmount').value) || 0;
    const roiPercent = parseFloat(document.getElementById('expectedROI').value) || 0;
    const months = parseFloat(document.getElementById('timePeriod').value) || 12;
    
    if (investment > 0 && roiPercent > 0) {
      const returnAmount = investment * (roiPercent / 100);
      const totalReturn = investment + returnAmount;
      const monthlyReturn = returnAmount / months;
      const paybackPeriod = (investment / monthlyReturn).toFixed(1);
      
      const resultHTML = `
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-4 text-sm">
            <div class="font-semibold">Total Return:</div>
            <div class="text-green-600 font-bold">$${totalReturn.toLocaleString()}</div>
            <div class="font-semibold">Net Profit:</div>
            <div class="text-green-600">$${returnAmount.toLocaleString()}</div>
            <div class="font-semibold">Monthly Return:</div>
            <div>$${monthlyReturn.toLocaleString()}</div>
            <div class="font-semibold">Payback Period:</div>
            <div>${paybackPeriod} months</div>
          </div>
          <div class="p-3 bg-blue-50 rounded-xl text-sm">
             <strong>Recommendation:</strong> ${roiPercent > 20 ? 'High ROI - Strong investment case' : roiPercent > 10 ? 'Moderate ROI - Consider strategic value' : 'Low ROI - Evaluate alternatives'}
          </div>
        </div>
      `;
      
      document.getElementById('roiResult').innerHTML = resultHTML;
      document.getElementById('roiResult').classList.remove('hidden');
    } else {
      showNotification('Please enter valid investment amount and ROI percentage', 'error');
    }
  }

  function openRiskAnalysis() {
    document.getElementById('riskModal').classList.remove('hidden');
  }

  function runRiskAnalysis() {
    const riskFactors = {
      platformDependency: 0.7,
      contentSaturation: 0.5,
      teamCapacity: 0.3,
      marketVolatility: 0.6,
      competition: 0.8
    };
    
    const totalRisk = (Object.values(riskFactors).reduce((a, b) => a + b, 0) / Object.values(riskFactors).length * 100).toFixed(1);
    
    const riskHTML = `
      <div class="space-y-4">
        <div class="text-center">
          <div class="text-2xl font-bold ${totalRisk > 70 ? 'text-red-600' : totalRisk > 40 ? 'text-yellow-600' : 'text-green-600'}">
            ${totalRisk}% Overall Risk
          </div>
          <div class="text-sm text-gray-600">${totalRisk > 70 ? 'High Risk - Immediate attention needed' : totalRisk > 40 ? 'Medium Risk - Monitor closely' : 'Low Risk - Stable operation'}</div>
        </div>
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div>Platform Dependency</div>
          <div class="text-right">70%</div>
          <div>Content Saturation</div>
          <div class="text-right">50%</div>
          <div>Team Capacity</div>
          <div class="text-right">30%</div>
          <div>Market Volatility</div>
          <div class="text-right">60%</div>
          <div>Competition</div>
          <div class="text-right">80%</div>
        </div>
      </div>
    `;
    
    document.getElementById('riskResult').innerHTML = riskHTML;
    document.getElementById('riskResult').classList.remove('hidden');
    
    // Update global risk metric
    currentMetrics.risk = totalRisk;
  }

  function openDecisionMatrix() {
    showNotification('Decision Matrix launched - Analyzing strategic options...', 'success');
  }

  function openStrategyBuilder() {
    showNotification('Strategy Builder activated - Ready for strategic planning session', 'success');
  }

  function checkTeamAvailability() {
    showNotification('Team status refreshed - All systems operational', 'success');
    initializeTeamStatus();
  }

  function closeModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
  }

  function openNewPolicyModal() {
    // This would open a modal for new policy creation
    showNotification('Policy creation interface ready', 'success');
  }

  /**************************************************************************
   * INITIALIZATION
   **************************************************************************/

  // Start the application
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeWelcomeModal);
  } else {
    initializeWelcomeModal();
  }

  // Update greeting every hour
  setInterval(setAutoGreeting, 3600000);

  // Refresh data every 30 seconds
  setInterval(fetchAllData, 30000);
  </script>
</body>
  </html>
